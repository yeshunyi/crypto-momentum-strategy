# 加密货币涨速交易策略

基于价格涨速和成交量变化识别短期强势币种，结合市场波动率动态调整参数的自动化量化交易策略。

## 策略概述

本策略主要关注短期内价格和成交量同时出现异常增长的加密货币，通过多维度的信号识别和风险控制体系，捕捉短线爆发行情。策略具有以下核心特点：

1. **动态涨速阈值**：根据市场波动率自动调整监控时间窗口和阈值
2. **多层信号确认**：结合价格涨速、成交量变化、板块轮动、社交媒体数据进行多维度分析
3. **分段式入场**：采用两阶段入场机制，降低追高风险
4. **动态止盈止损**：基于市场波动设置止盈目标，采用分段止盈和移动止损
5. **严格风险控制**：设置单笔风险、总风险、板块集中度等多层风险控制

## 项目结构

```
├── momentum_strategy.py    # 策略主程序
├── config.py               # 配置管理
├── data_provider.py        # 市场数据提供
├── market_analyzer.py      # 市场分析
├── signal_generator.py     # 信号生成
├── risk_manager.py         # 风险管理
├── order_executor.py       # 订单执行
├── performance_tracker.py  # 绩效分析
├── utils/                  # 工具函数
│   ├── __init__.py
│   └── logger.py           # 日志工具
├── data/                   # 数据存储
├── logs/                   # 日志存储
├── config.yaml             # 配置文件
└── requirements.txt        # 依赖包列表
```

## 安装

1. 克隆仓库到本地：

```bash
git clone https://github.com/yourusername/crypto-momentum-strategy.git
cd crypto-momentum-strategy
```

2. 安装依赖包：

```bash
pip install -r requirements.txt
```

3. 配置交易所API：
   - 复制并编辑 `config.yaml` 文件
   - 填入您的交易所API密钥和其他配置参数

## 使用方法

1. 开始运行策略：

```bash
python momentum_strategy.py
```

2. 使用快速启动脚本（推荐）：

```bash
# 跳过耗时的黑名单和板块排名初始化
python quick_start.py --skip-blacklist --skip-sectors

# 启用详细日志
python quick_start.py --debug

# 使用自定义配置文件
python quick_start.py --config my_config.yaml
```

3. 查看日志和绩效报告：
   - 日志文件保存在 `logs/` 目录
   - 交易记录和绩效报告保存在 `data/` 目录
   - 绩效图表保存在 `data/charts/` 目录

## 常见问题解决

### 策略启动后卡住不动

如果策略在启动后显示"策略开始运行..."然后卡住，可能是由于以下原因：

1. **更新黑名单卡住**：处理大量币种时可能耗时过长
   - 解决方案：使用 `quick_start.py --skip-blacklist` 跳过黑名单初始化

2. **板块排名卡住**：获取板块数据时API请求频繁可能导致卡住
   - 解决方案：使用 `quick_start.py --skip-sectors` 跳过板块排名初始化

3. **API连接问题**：交易所API可能存在连接问题
   - 解决方案：检查API密钥是否有效，网络连接是否稳定

4. **资源占用过高**：处理大量数据可能导致内存占用过高
   - 解决方案：调整 `config.yaml` 中的扫描间隔和数据刷新间隔

### 超时保护机制

最新版本已添加超时保护机制，防止关键操作卡住：

- 黑名单更新：最多处理120秒，最多处理100个币种
- 板块排名：最多处理60秒，每个板块最多处理15秒
- 定时任务执行：记录耗时超过30秒的任务

## 参数配置

策略参数可以通过 `config.yaml` 文件配置，主要配置项包括：

### 基本配置

```yaml
basic:
  scan_interval: 5                      # 扫描市场间隔（分钟）
  data_refresh_interval: 60             # 数据刷新间隔（秒）
  market_state_refresh_interval: 3600   # 市场状态刷新间隔（秒）
```

### 账户配置

```yaml
account:
  balance: 10000.0                      # 账户余额（美元）
```

### 交易所配置

```yaml
exchange:
  supported: ["binance", "kucoin"]      # 支持的交易所
  default: "binance"                    # 默认交易所
  api_keys:                             # API密钥
    binance:
      api_key: "YOUR_API_KEY_HERE"
      secret_key: "YOUR_SECRET_KEY_HERE"
    kucoin:
      api_key: "YOUR_API_KEY_HERE"
      secret_key: "YOUR_SECRET_KEY_HERE"
  test_mode: true                       # 是否使用测试模式
  dry_run: true                         # 是否模拟交易
  quote_currencies: ["USDT", "BUSD", "USDC"]  # 支持的计价货币
```

### 交易配置

```yaml
trading:
  max_risk_per_trade: 2.0               # 单笔风险敞口（%）
  max_total_risk: 15.0                  # 总风险敞口（%）
  max_sector_allocation: 0.4            # 单一板块最大占比
  max_new_positions: 3                  # 每次扫描最多开仓数量
```

### 订单执行配置

```yaml
order_execution:
  min_order_amount: 10.0                # 最小下单金额（美元）
  iceberg_threshold: 1000.0             # 冰山订单阈值（美元）
```

## 策略流程

1. **市场扫描**：定期扫描市场，根据当前市场波动率确定涨速监控窗口和阈值
2. **信号生成**：基于涨速、成交量、RSI等技术指标生成初步信号
3. **信号筛选**：过滤黑名单、超买超卖、风险过高的信号
4. **风险评估**：根据当前持仓、市场状态、板块分配评估风险
5. **仓位管理**：确定最佳入场时机和仓位大小
6. **分段入场**：第一阶段试探性入场，第二阶段在价格突破前高时跟进
7. **动态止盈**：根据ATR设置止盈目标，分三段执行止盈
8. **风险控制**：设置固定止损、移动止损和时间止损

## 注意事项

- 本策略适合短期交易，平均持仓时间4小时内
- 在熊市或高波动环境下应减小仓位或暂停交易
- 建议使用干净的API密钥，并开启仅交易权限
- 首次使用时建议开启模拟交易模式（dry_run=true）

## 绩效跟踪

策略会自动记录所有交易并生成以下绩效报告：
- 每日交易统计报告
- 累计盈亏曲线图
- 盈亏分布柱状图
- 按交易对的盈利分析
- 年化收益率、最大回撤、夏普比率等指标

## 风险提示

加密货币市场风险极高，价格波动剧烈。本策略仅供学习和研究使用，不构成投资建议。使用本策略进行实盘交易需自行承担所有风险。

## 许可证

MIT

## 一、涨速筛选核心参数设计

### 涨速阈值动态模型
- **基础公式**：涨速 = (当前价 - N分钟前价格) / N分钟前价格 × 100%
- **时间窗口选择**：
  | 市场状态 | 时间窗口 | 涨速阈值 | 适用场景 |
  |---------|---------|---------|---------|
  | 高波动时段（ATR>5%） | 5分钟 | 3%-5% | 牛市爆发期、重大利好公告后 |
  | 中波动时段（3%≤ATR≤5%） | 10分钟 | 2%-3% | 正常交易环境 |
  | 低波动时段（ATR<3%） | 15分钟 | 1.5%-2.5% | 盘整期、低迷行情 |


### 成交量验证机制
- **基本要求**：涨速达标且量比>2倍（量比=当前成交量/过去20日均值）


### 板块轮动优先级
- 每小时更新交易所内概念板块（如AI、Layer2）的涨速排名，优先操作前3名板块内标的

- **板块强度评分**：
  ```
  板块强度 = (板块内币种平均涨幅 × 0.4) + (板块内领涨币24h涨幅 × 0.3) + (板块成交量增长率 × 0.3)
  ```

## 二、风险控制体系


### 波动率预警机制
- 当日内ATR超过7%时，触发高风险警报，减半仓位上限
- 连续3日大幅跳空缺口，暂停新开仓位

## 三、动态执行与仓位控制

### 二段式入场规则
| 阶段 | 触发条件 | 仓位分配 | 执行要点 |
|-----|---------|---------|---------|
| 1 | 涨速突破阈值+量比>1.5 | 50% | 首次突破信号确认 |
| 2 | 价格突破前高+RSI<70 | 50% | 趋势确认后跟进 |

### 动态止盈
- 盈利目标设定为当日ATR的1.5倍(例如当前ATR=4%，则止盈6%)
- 移动止盈：盈利超过3%后，止损线上移至成本价


### 固定止损
- 跌破入场价2%立即止损

### 黑名单机制
自动排除以下币种：
- 近7日最大回撤>25%
- 交易所风险提示次数≥3次/周
- 近30日交易量<1000000
- 开发团队负面消息频出的项目

## 四、交易执行

### 订单执行策略
2. **使用冰山订单**：分拆大单，避免价格冲击，每批次不超过市场深度的10%
3. **使用限价单**：避免追高，设置合理买入价格上限
4. **使用条件单**：预设止损单，避免亏损扩大
